var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(e,t){this.textField.text="游戏加载中..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this._isDebug=!1,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},n.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.createGameScene())},n.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},n.createGameScene=function(){function e(e){var i=Math.floor(e.stageX/n),s=Math.floor((egret.MainContext.instance.stage.stageHeight-e.stageY)/n);t(i,s)}function t(e,t){if(Math.random()>.5){var i=new p2.Rectangle(2,1),o=new p2.Body({mass:1,position:[e,t],angularVelocity:1});o.addShape(i),s.addBody(o);var a=r.createBitmapByName("rect");a.width=i.width*n,a.height=i.height*n}else{var i=new p2.Circle(1),o=new p2.Body({mass:1,position:[e,t]});o.addShape(i),s.addBody(o);var a=r.createBitmapByName("circle");a.width=2*i.radius*n,a.height=2*i.radius*n}r._isDebug||(a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,o.displays=[a],r.addChild(a))}var i=this,n=50,s=new p2.World;s.sleepMode=p2.World.BODY_SLEEPING;var o=new p2.Plane,a=new p2.Body;a.addShape(o),a.displays=[],s.addBody(a),egret.Ticker.getInstance().register(function(e){if(!(10>e||e>1e3||(s.step(e/1e3),r._isDebug)))for(var t=egret.MainContext.instance.stage.stageHeight,i=s.bodies.length,o=0;i>o;o++){var a=s.bodies[o],d=a.displays[0];d&&(d.x=a.position[0]*n,d.y=t-a.position[1]*n,d.rotation=360-180*a.angle/Math.PI,a.sleepState==p2.Body.SLEEPING?d.alpha=.5:d.alpha=1)}},this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e,this);for(var r=this,d=0;8>d;d++)t(2*d+2,2*d+5);var h=RES.getRes("font_fnt"),g=new egret.BitmapText;g.text="Click!",g.font=h,g.anchorOffsetX=g.width/2,g.anchorOffsetY=g.height/2,g.x=this.stage.stageWidth/2,g.y=this.stage.stageHeight/2,this.addChild(g),g.touchEnabled=!0,g.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){i.removeChild(g)},this)},n.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");